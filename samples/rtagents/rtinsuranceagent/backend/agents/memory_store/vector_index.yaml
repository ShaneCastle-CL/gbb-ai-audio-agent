index:
  # ---- primary DiskANN vector index ----
  name: diskann_memory_vec
  emb_field: memoryVector
  max_dim: 1536
  similarity: COS
  maxDegree: 32
  lBuild: 64

  # ---- helper (B-tree) indexes ----
  helper_indexes:
    # Fast user filter
    - name: uid_idx
      key: { user_id: 1 }

    # UNIQUE compound index: one user, many unique memory_id values
    - name: user_mem_uidx
      key: { user_id: 1, memory_id: 1 }
      unique: true

    # Optional query helpers
    - name: intent_idx
      key: { intent: 1 }

    - name: ts_desc_idx          # keep existing name to avoid code 85 conflict
      key: { timestamp: -1 }