# yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-dev/main/schemas/v1.0/azure.yaml.json
name: gbb-ai-audio-agent
metadata:
  template: azd-init@1.15.1

infra:
  provider: terraform
  path: ./infra/terraform

services:
  rtaudio-client:
    project: apps/rtagent/frontend
    host: appservice
    language: js

# Backend is deployed via predeploy hook to support shared dependencies
# Frontend deployment is handled by the same predeploy hook for consistency

  # rtaudio-server-aca:
  #   project: apps/RTAgent/backend
  #   host: containerapp
  #   language: python
  #   docker:
  #     path: ./Dockerfile
  #     context: ../../../
  #     platform: linux/amd64


hooks:
  preprovision:
    shell: sh
    run: devops/scripts/azd/preprovision.sh terraform
    interactive: true
    continueOnError: false

  predeploy:
    shell: sh
    run: devops/scripts/azd/helpers/appsvc-deploy.sh backend
    interactive: true
    continueOnError: true

  postprovision:
    shell: sh
    run: devops/scripts/azd/postprovision.sh
    interactive: true
    continueOnError: false
 

# For container app deploy
# services:
#   rtaudio-client:
#     project: rtagents/RTAgent/frontend
#     host: containerapp
#     language: js
#     docker:
#       path: ./Dockerfile
#       context: .
#       platform: linux/amd64
      
#   rtaudio-server:
#     project: rtagents/RTAgent/backend
#     host: containerapp
#     language: python
#     docker:
#       path: ./Dockerfile
#       context: ../../../
#       platform: linux/amd64

